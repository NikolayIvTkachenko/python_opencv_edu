# Введение в калибровку камер
# Что такое калибровка камеры?
#
# Калибровка камеры — это процесс определения параметров камеры, которые позволяют корректировать искажения
# на изображении, вызванные оптикой, и точно описывать геометрию камеры. В результате калибровки определяются как
# внутренние, так и внешние параметры камеры.
# Почему калибровка важна?
#
# Линзы камеры вызывают искажения, особенно на краях изображения. Это приводит к эффектам бочкообразного или
# подушкообразного искажения.
# Точные внутренние параметры камеры (например, фокусное расстояние, центр изображения) необходимы для многих
# задач, таких как стереозрение и 3D-реконструкция.
# 2. Основные параметры камеры
# Внутренние параметры (Intrinsic Parameters):
#
# Фокусное расстояние (fx, fy): Описывает масштаб изображения в пикселях по оси X и Y.
# Главная точка (cx, cy): Описывает центр изображения (обычно центр сенсора камеры).
# Коэффициенты дисторсии (k1, k2, p1, p2, k3): Описывают степень искажения изображения из-за оптики камеры.
# Внешние параметры (Extrinsic Parameters):
#
# Ротация (R): Определяет ориентацию (углы поворота) камеры в пространстве.
# Трансляция (T): Определяет положение (смещение) камеры в пространстве.
# 3. Подготовка к калибровке камеры
# Необходимо собрать калибровочные изображения, содержащие известный паттерн, например, шахматную доску.
# Эти изображения будут использоваться для нахождения параметров камеры.


# Выбор калибровочного паттерна:
#
# Чаще всего используется шахматная доска или круговые мишени. Размеры и количество квадратов на шахматной
# доске должны быть известны. Например, этот файл, будет содержать 6*9 вершин, по которым и будет происходить
# калибровка! Распечатайте его, закрепите на ровную поверхность.
# Сбор изображений:
#
# Сделайте несколько снимков шахматной доски с разных углов и расстояний. Это необходимо для более точной
# калибровки. Разумеется, снимки должны быть сделаны той камерой, которая будет использоваться.
# Пример кода для сохранения изображений шахматной доски с веб-камеры:

import cv2
import os
import time


cv2.namedWindow("preview")
cam = cv2.VideoCapture(0, cv2.CAP_DSHOW)
#0 - номер камеры
cam.set(3,1920)
cam.set(4,1080)

if cam.isOpened():
    read_ok, image = cam.read()
    if not os.path.isdir('images'):#проверяем наличие папки
        os.mkdir ('images')# если нет, создаем
else:
    read_ok = False

while read_ok:
    cv2.imshow("preview", image)
    read_ok, image = cam.read()
    key = cv2.waitKey(20)
    if key == 32:
        cv2.imwrite(f"images/{time.time()}.jpg", image)
        print(f"File: images/{time.time()}.jpg saved")
    if key == 27: # exit on ESC
        break

cam.release()
cv2.destroyWindow("preview")
#0 - номер камеры
cam.set(3,1920)
cam.set(4,1080)

if cam.isOpened():
    read_ok, image = cam.read()
    if not os.path.isdir('images'):#проверяем наличие папки
        os.mkdir ('images')# если нет, создаем
else:
    read_ok = False

while read_ok:
    cv2.imshow("preview", image)
    read_ok, image = cam.read()
    key = cv2.waitKey(20)
    if key == 32:
        cv2.imwrite(f"images/{time.time()}.jpg", image)
        print(f"File: images/{time.time()}.jpg saved")
    if key == 27: # exit - ESC
        break

cam.release()
cv2.destroyWindow("preview")